<%= form_with model: [@coffee_bean, @tasting_note], local: true do |f| %>
  <!-- エラーメッセージ -->
  <% if @tasting_note.errors.any? %>
    <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
      <h3 class="text-sm font-medium text-red-800 mb-2">
        <%= pluralize(@tasting_note.errors.count, "件のエラー") %>が発生しました
      </h3>
      <ul class="list-disc list-inside text-sm text-red-700 space-y-1">
        <% @tasting_note.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="space-y-6">
    <!-- 抽出方法 -->
    <div>
      <%= f.label :brew_method, "抽出方法", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= f.select :brew_method,
          ["ハンドドリップ", "エスプレッソ", "フレンチプレス", "エアロプレス", "サイフォン", "水出し", "その他"],
          { include_blank: "抽出方法を選択してください" },
          class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200" %>
    </div>

    <!-- 好み度（星評価） -->
    <div>
      <%= f.label :preference_score, "好み度", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <div class="star-rating flex flex-row-reverse items-center gap-2 justify-end">
        <% (1..5).reverse_each do |score| %>
          <%= f.radio_button :preference_score, score,
            id: "preference_#{score}",
            class: "hidden",
            checked: @tasting_note.preference_score == score
          %>
          <label for="preference_<%= score %>" class="cursor-pointer text-2xl text-gray-300 hover:text-yellow-400 transition">
            ★
          </label>
        <% end %>
      </div>
    </div>

    <!-- 酸味の強さ（星評価） -->
    <div>
      <%= f.label :acidity_score, "酸味の強さ", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <div class="star-rating flex flex-row-reverse items-center gap-2 justify-end">
        <% (1..5).reverse_each do |score| %>
          <%= f.radio_button :acidity_score, score,
            id: "acidity_#{score}",
            class: "hidden",
            checked: @tasting_note.acidity_score == score
          %>
          <label for="acidity_<%= score %>" class="cursor-pointer text-2xl text-gray-300 hover:text-yellow-400 transition">
            ★
          </label>
        <% end %>
      </div>
    </div>

    <!-- 苦味の強さ（星評価） -->
    <div>
      <%= f.label :bitterness_score, "苦味の強さ", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <div class="star-rating flex flex-row-reverse items-center gap-2 justify-end">
        <% (1..5).reverse_each do |score| %>
          <%= f.radio_button :bitterness_score, score,
            id: "bitterness_#{score}",
            class: "hidden",
            checked: @tasting_note.bitterness_score == score
          %>
          <label for="bitterness_<%= score %>" class="cursor-pointer text-2xl text-gray-300 hover:text-yellow-400 transition">
            ★
          </label>
        <% end %>
      </div>
    </div>

    <!-- 甘さ（星評価） -->
    <div>
      <%= f.label :sweetness_score, "甘さ", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <div class="star-rating flex flex-row-reverse items-center gap-2 justify-end">
        <% (1..5).reverse_each do |score| %>
          <%= f.radio_button :sweetness_score, score,
            id: "sweetness_#{score}",
            class: "hidden",
            checked: @tasting_note.sweetness_score == score
          %>
          <label for="sweetness_<%= score %>" class="cursor-pointer text-2xl text-gray-300 hover:text-yellow-400 transition">
            ★
          </label>
        <% end %>
      </div>
    </div>

    <!-- 風味メモ -->
    <div>
      <%= f.label :taste_notes, "風味メモ", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= f.text_area :taste_notes, rows: 4,
          class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200",
          placeholder: "感じた風味や香りを記入してください" %>
    </div>

    <!-- 購入店舗（任意） -->
    <div class="border-t border-gray-200 pt-6">
      <h3 class="text-lg font-medium text-gray-900 mb-4">購入店舗（任意）</h3>
      
      <!-- 既存店舗から選択 -->
      <div class="mb-4">
        <%= f.label :shop_id, "既存の店舗から選択", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.collection_select :shop_id, Shop.all.order(:name), :id, :name,
            { prompt: "店舗を選択してください（任意）" },
            class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200" %>
      </div>

      <!-- 新規店舗を入力 -->
      <div class="bg-gray-50 rounded-lg p-4">
        <p class="text-sm font-medium text-gray-700 mb-3">または新しい店舗を登録：</p>
        
        <div class="space-y-3">
          <div>
            <%= label_tag 'shop[name]', '店舗名', class: "block text-sm text-gray-600 mb-1" %>
            <%= text_field_tag 'shop[name]', nil,
                class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200 text-sm",
                placeholder: "例：スターバックス 渋谷店" %>
          </div>
          
          <div>
            <%= label_tag 'shop[address]', '住所', class: "block text-sm text-gray-600 mb-1" %>
            <%= text_field_tag 'shop[address]', nil,
                class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200 text-sm",
                placeholder: "例：東京都渋谷区..." %>
          </div>
        </div>
        
        <p class="text-xs text-gray-500 mt-2">
          ※ 店舗名を入力すると、既存の店舗選択は無視されます
        </p>
      </div>
    </div>

    <!-- ボタン -->
    <div class="flex gap-4">
      <button
        onclick="history.back()"
        type="button"
        class="flex-1 bg-gray-200 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition duration-200 text-center">
        キャンセル
      </button>
      <%= f.submit button_text, 
          class: "flex-1 bg-[#be9d79] text-white py-3 px-4 rounded-lg font-medium hover:bg-[#a07c5a] focus:outline-none focus:ring-2 focus:ring-[#a07c5a] focus:ring-offset-2 transition duration-200 cursor-pointer" %>
    </div>
  </div>
<% end %>
